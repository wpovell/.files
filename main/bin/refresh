#!/usr/bin/env python3
import glob
import re

with open('/home/wpovell/.theme') as f:
    dat = f.read().strip()
colors = re.findall(r'([FBC\d]{2,3})\s+(\#[\da-f]{6})', dat, re.IGNORECASE)
colors.sort(key = lambda x: -len(x[0]))
toWrite = ""

with open('/home/wpovell/www/index.css.gen') as f:
    css = f.read()

gens = ['/home/wpovell/.mozilla/firefox/fb8uvoz6.default/chrome/userChrome.css.gen', '/home/wpovell/.config/dunst/dunstrc.gen']
genOut = []
for g in gens:
    with open(g, 'r') as f:
        genOut.append(f.read())

for c, v in colors:
    ## Terminals
    # Get in rr/gg/bb format
    hexc = v[1:].lower()
    hexc = '/'.join(map(''.join, zip(*[iter(hexc)]*2)))
    n = ''
    fmt = lambda n, c: "\033]{};rgb:{}\007".format(n, c)
    if c == 'FC':
        toWrite += fmt('10', hexc)
    if c == 'BC':
        toWrite += fmt('708', hexc)
        toWrite += fmt('11', hexc)
    elif c == 'CC':
        toWrite += fmt('12', hexc)
    else:
        n = c.replace('C','')
        toWrite += fmt('4;'+n, hexc)

    for i,g in enumerate(genOut):
        genOut[i] = g.replace(c, v.lower())
    css = css.replace(c, v.lower())

with open('/home/wpovell/www/index.css', 'w') as f:
    f.write(css)
    
for i, g in enumerate(gens):
    with open(g[:-4], 'w') as f:
        f.write(genOut[i])
    
for term in glob.glob("/dev/pts/[0-9]*"):
    with open(term, "w") as file:
        file.write(toWrite)
