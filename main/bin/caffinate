#!/bin/bash

# Script to prevent sleep/lock while fullscreen

systemctl --user import-environment DISPLAY XAUTHORITY

if which dbus-update-activation-environment >/dev/null 2>&1; then
        dbus-update-activation-environment DISPLAY XAUTHORITY
fi

FN="/tmp/lock_disabled"

xprop_active_info () {
    xprop -id "$(xprop -root _NET_ACTIVE_WINDOW | awk '{print $5}')"
}

we_are_fullscreen () {
    xprop_active_info | grep _NET_WM_STATE_FULLSCREEN
}

disable_sleep () {
  polybar-msg hook lock 2
  xset -dpms
  xautolock -disable
}

enable_sleep () {
  if [[ ! -f $FN ]]; then
      polybar-msg hook lock 1
      xset +dpms
      xautolock -enable
  fi
}

if [[ "$1" = "toggle" ]]; then
    if [[ -f $FN ]]; then
        rm $FN
        enable_sleep
    else
        touch $FN
        disable_sleep
    fi
elif [[ -n $(we_are_fullscreen) ]]; then
    disable_sleep
else
    enable_sleep
fi
